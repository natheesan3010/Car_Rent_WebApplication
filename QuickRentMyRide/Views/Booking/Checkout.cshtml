@{
    ViewBag.Title = "Checkout";
    var booking = ViewBag.Booking as QuickRentMyRide.Models.Booking;
    var publishableKey = ViewBag.PublishableKey as string;
}
<script src="https://js.stripe.com/v3/"></script>

<div class="container py-5">
    <div class="card shadow-sm p-4 mx-auto" style="max-width: 500px;">
        <h3 class="mb-3">Checkout - Booking #@booking.BookingID</h3>
        <p><b>Car:</b> @booking.Car.CarModel</p>
        <p><b>Total Price:</b> $@booking.TotalPrice</p>

        <button id="checkout-button" class="btn btn-success w-100">
            <i class="bi bi-credit-card"></i> Pay Now
        </button>
    </div>
</div>

<script>
    var stripe = Stripe('@publishableKey');

    document.getElementById("checkout-button").addEventListener("click", function () {
        fetch('@Url.Action("CreateCheckoutSession", "Booking", new { id = booking.BookingID })', {
            method: 'POST'
        })
        .then(res => res.json())
        .then(data => stripe.redirectToCheckout({ sessionId: data.id }))
        .then(result => { if (result.error) alert(result.error.message); })
        .catch(error => console.error("Error:", error));
    });
</script>
