@model List<QuickRentMyRide.Models.Car>

@{
    ViewBag.Title = "Customer Dashboard";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";

    var username = ViewBag.Username as string ?? "Guest";

    var isGuest = username == "Guest";
    var availableCars = Model ?? new List<QuickRentMyRide.Models.Car>();

    // Single session check
    var isLoggedIn = Context.Session.GetInt32("CustomerID") != null;
}

@if (isGuest)
{
    <div class="alert alert-warning text-center mt-5">
        You are not logged in. Please <a asp-controller="Account" asp-action="Login">login</a> to access the dashboard.
    </div>
}
else
{
    <div class="container mt-5">
        <h2 class="mb-3">Welcome, @username!</h2>
        <p class="text-muted">From here, you can check availability, view bookings, manage your profile, and book cars.</p>
    </div>

    <div class="container mb-5">
        <div class="row g-4">

            <!-- Check Availability -->
            <div class="col-md-4">
                <div class="card shadow-sm h-100 text-center p-4 d-flex flex-column">
                    <i class="bi bi-calendar-check text-primary fs-1 mb-3"></i>
                    <h5 class="card-title fw-bold">Check Availability</h5>
                    <p class="text-muted">See which cars are available for your dates</p>
                    <a asp-controller="Booking" asp-action="CheckAvailability" class="btn btn-primary mt-auto w-100">
                        Search Cars
                    </a>
                </div>
            </div>

            <!-- My Bookings -->
            <div class="col-md-4">
                <div class="card shadow-sm h-100 text-center p-4 d-flex flex-column">
                    <i class="bi bi-journal-check text-success fs-1 mb-3"></i>
                    <h5 class="card-title fw-bold">My Bookings</h5>
                    <p class="text-muted">View your booking history</p>

                    @if (isLoggedIn)
                    {
                        <a asp-controller="Booking" asp-action="MyBookings" class="btn btn-success mt-auto w-100">
                            View Bookings
                        </a>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-success mt-auto w-100">
                            Login to View
                        </a>
                    }
                </div>
            </div>

            <!-- Profile -->
            <div class="col-md-4">
                <div class="card shadow-sm h-100 text-center p-4 d-flex flex-column">
                    <i class="bi bi-person-circle text-warning fs-1 mb-3"></i>
                    <h5 class="card-title fw-bold">Profile</h5>
                    <p class="text-muted">Edit your personal details</p>

                    @if (isLoggedIn)
                    {
                        <a asp-controller="Customer" asp-action="Profile" class="btn btn-warning mt-auto w-100">
                            Edit Profile
                        </a>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-warning mt-auto w-100">
                            Login to Edit
                        </a>
                    }
                </div>
            </div>

        </div>
    </div>

    <!-- Available Cars -->
    <div class="container">
        <h3 class="mb-4">Available Cars</h3>
        <div class="row g-4">
            @if (availableCars.Any())
            {
                @foreach (var car in availableCars)
                {
                    <div class="col-md-4">
                        <div class="card shadow-sm h-100">
                            <img src="@car.CarImage" class="card-img-top" alt="@car.CarBrand @car.CarModel" style="height:200px; object-fit:cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">@car.CarBrand @car.CarModel</h5>
                                <p class="text-primary fw-bold">LKR @car.RentPerDay</p>
                                <a asp-controller="Booking" asp-action="Create" asp-route-carID="@car.CarID" class="btn btn-primary mt-auto w-100">BOOK NOW</a>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="alert alert-warning text-center">No cars available at the moment.</div>
                </div>
            }
        </div>
    </div>
}
